<%- include("../layouts/userHeader") %>

    <style>
        .error {
            color: red;
            font-size: 15px;
        }

        .address-list {
            list-style-type: none;
            padding: 0;
        }

        .address-item {
            margin-bottom: 10px;
        }

        .address-item span {
            margin-right: 5px;
        }

        .copy-icon {
            cursor: pointer;
        }
    </style>

    <main class="main">
        <div class="page-header breadcrumb-wrap">
            <div class="container">
                <div class="breadcrumb">
                    <a href="index.html" rel="nofollow">Home</a>
                    <span></span> Pages
                    <span></span> Account
                </div>
            </div>
        </div>
        <section class="pt-150 pb-150 ml-3">
            <div class="containe">
                <div class="row">
                    <div class="col-lg-10 m-auto">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="dashboard-menu">
                                    <ul class="nav flex-column" role="tablist">
                                        <li class="nav-item">
                                            <a class="nav-link active" id="dashboard-tab" data-bs-toggle="tab"
                                                href="#dashboard" role="tab" aria-controls="dashboard"
                                                aria-selected="false"><i
                                                    class="fi-rs-settings-sliders mr-10"></i>Dashboard</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="orders-tab" data-bs-toggle="tab" href="#orders"
                                                role="tab" aria-controls="orders" aria-selected="false"><i
                                                    class="fi-rs-shopping-bag mr-10"></i>Orders</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="track-orders-tab" data-bs-toggle="tab"
                                                href="#wallet" role="tab" aria-controls="track-orders"
                                                aria-selected="false"><i
                                                    class="fi-rs-shopping-cart-check mr-10"></i>Wallet</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="address-tab" data-bs-toggle="tab" href="#address"
                                                role="tab" aria-controls="address" aria-selected="true"><i
                                                    class="fi-rs-marker mr-10"></i>My Address</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="account-detail-tab" data-bs-toggle="tab"
                                                href="#account-detail" role="tab" aria-controls="account-detail"
                                                aria-selected="true"><i class="fi-rs-user mr-10"></i>Account Details</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" href="page-login-register.html"><i
                                                    class="fi-rs-sign-out mr-10"></i>Logout</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="tab-content dashboard-content">
                                    <div class="tab-pane fade active show" id="dashboard" role="tabpanel"
                                        aria-labelledby="dashboard-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="mb-0">Profile</h5>
                                            </div>
                                            <div class="card-body">
                                                <p>Your email: <%= user.email %>
                                                </p>
                                                <p>Your phone: <%= user.phone %>
                                                </p>
                                                <p>Your referral Code: <span id="referralCode">
                                                        <%= user.referralCode %>
                                                    </span>
                                                    <span class="copy-icon" onclick="copyToClipboard()"> ðŸ“‹ </span>
                                                </p>
                                                <h6>Addresses:</h6>
                                                <ul class="address-list">
                                                    <% addresses.forEach(address=> { %>
                                                        <% address.items.forEach(item=> { %>
                                                            <li class="address-item">
                                                                &#8226; <%= item.address %>, <%= item.city %>, <%=
                                                                            item.state %>
                                                                            ,
                                                                            <%= item.pincode %>
                                                            </li>
                                                            <% }); %>
                                                                <% }); %>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="orders" role="tabpanel" aria-labelledby="orders-tab">
                                        <div class="card" style="display: flex; flex-direction: column;">
                                            <div class="card-header">
                                                <h5 class="mb-0">Your Orders</h5>
                                            </div>
                                            <div class="card-body" style="flex: 1;">
                                                <div class="table-responsive">
                                                    <table class="table">
                                                        <thead>
                                                            <tr>
                                                                <th>SrNo</th>
                                                                <th>Image</th>
                                                                <th>Name</th>
                                                                <th>Status</th>
                                                                <th>Total</th>
                                                                <th>Actions</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <% order.forEach((order, index)=> { %>
                                                                <% order.products.forEach((product, productIndex)=> { %>
                                                                    <tr>
                                                                        <% if(productIndex===0) { %>
                                                                            <td rowspan="<%= order.products.length %>">
                                                                                <%= (orderPage - 1) * 5 + index + 1 %>
                                                                            </td>
                                                                            <td rowspan="<%= order.products.length %>">
                                                                                <% order.products.forEach((product)=> {
                                                                                    %>
                                                                                    <% if
                                                                                        (product.productId.productImages.length>
                                                                                        0) { %>
                                                                                        <img src="/uploads/<%= product.productId.productImages[0] %>"
                                                                                            alt=""
                                                                                            style="width: 150px;">
                                                                                        <% } %>
                                                                                            <% }) %>
                                                                            </td>
                                                                            <% } %>
                                                                                <td>
                                                                                    <%= product.productId.productname %>
                                                                                </td>
                                                                                <td>
                                                                                    <%= order.orderStatus %>
                                                                                </td>
                                                                                <% if(productIndex===0) { %>
                                                                                    <td
                                                                                        rowspan="<%= order.products.length %>">
                                                                                        $<%= order.totalAmount.toFixed(2)
                                                                                            %>
                                                                                    </td>
                                                                                    <td
                                                                                        rowspan="<%= order.products.length %>">
                                                                                        <a href="/user/orderdetails/<%= order._id %>"
                                                                                            class="btn-small d-block">View</a>
                                                                                    </td>
                                                                                    <% } %>
                                                                    </tr>
                                                                    <% }) %>
                                                                        <% }) %>
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <nav aria-label="Page navigation" class="mt-4">
                                                    <ul class="pagination justify-content-center">
                                                        <% for(let i=1; i <=totalPages; i++) { %>
                                                            <li
                                                                class="page-item <%= i === orderPage ? 'active' : '' %>">
                                                                <a class="page-link" href="?orderPage=<%= i %>">
                                                                    <%= i %>
                                                                </a>
                                                            </li>
                                                            <% } %>
                                                    </ul>
                                                </nav>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="wallet" role="tabpanel"
                                        aria-labelledby="track-orders-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="mb-0">Your Wallet</h5>
                                            </div>

                                            <div class="card-body contact-from-area">
                                                <div id="balance">
                                                    <h5>Account Balance</h5>
                                                    <p>
                                                        Your current balance:<span class="ml-10"
                                                            style="font-size: medium; font-weight: 600">â‚¹ <%=
                                                                wallet.amount %></span>
                                                    </p>
                                                    <br /><br />
                                                </div>

                                                <div class="row">
                                                    <div class="col-lg-8">
                                                        <section id="transaction-history">
                                                            <h5>Transaction History</h5>
                                                            <table>
                                                                <thead>
                                                                    <tr>
                                                                        <th>Date</th>
                                                                        <th>Payment Method</th>
                                                                        <th>Amount</th>
                                                                        <th>Payment status</th>
                                                                    </tr>
                                                                </thead>

                                                                <tbody>
                                                                    <% if (wallet && wallet.transaction) { %>
                                                                        <% wallet.transaction.forEach(function(transaction)
                                                                            { %>
                                                                            <tr>
                                                                                <td>
                                                                                    <%= new
                                                                                        Date(transaction.date).toLocaleDateString('en-IN')
                                                                                        %>
                                                                                </td>
                                                                                <td>
                                                                                    <%= transaction.paymentMethod %>
                                                                                </td>
                                                                                <td>
                                                                                    <%= transaction.amount %>
                                                                                </td>
                                                                                <td>
                                                                                    <%= transaction.paymentStatus %>
                                                                                </td>
                                                                            </tr>
                                                                            <% }); %>
                                                                                <% } else { %>
                                                                                    <tr>
                                                                                        <td colspan="4">
                                                                                            No transactions available.
                                                                                        </td>
                                                                                    </tr>
                                                                                    <% } %>
                                                                </tbody>
                                                            </table>
                                                        </section>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="tab-pane fade" id="track-orders" role="tabpanel"
                                        aria-labelledby="track-orders-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="mb-0">Orders tracking</h5>
                                            </div>
                                            <div class="card-body contact-from-area">
                                                <p>To track your order please enter your OrderID in the box below
                                                    and
                                                    press "Track" button. This was given to you on your receipt and
                                                    in
                                                    the confirmation email you should have received.</p>
                                                <div class="row">
                                                    <div class="col-lg-8">
                                                        <form class="contact-form-style mt-30 mb-50" action="#"
                                                            method="post">
                                                            <div class="input-style mb-20">
                                                                <label>Order ID</label>
                                                                <input name="order-id"
                                                                    placeholder="Found in your order confirmation email"
                                                                    type="text" class="square">
                                                            </div>
                                                            <div class="input-style mb-20">
                                                                <label>Billing email</label>
                                                                <input name="billing-email"
                                                                    placeholder="Email you used during checkout"
                                                                    type="email" class="square">
                                                            </div>
                                                            <button class="submit submit-auto-width"
                                                                type="submit">Track</button>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="address" role="tabpanel"
                                        aria-labelledby="address-tab">
                                        <div class="container">
                                            <div class="row">
                                                <% addresses.forEach(address=> { %>
                                                    <% address.items.forEach(item=> { %>
                                                        <div class="col-lg-6">
                                                            <div class="card mb-3">
                                                                <div class="card-header">
                                                                    <h5 class="mb-0">Shipping Address</h5>
                                                                </div>
                                                                <div class="card-body" id="card-body">
                                                                    <address>
                                                                        <%= item.address %><br>
                                                                            <%= item.city %>, <%= item.state %>
                                                                                    <%= item.pincode %> <br>
                                                                                        Phone: <%= item.phone %>
                                                                    </address>
                                                                    <p>
                                                                        <%= item.district %>
                                                                    </p>
                                                                    <div class="d-flex justify-content">
                                                                        <button type="button"
                                                                            class="btn btn-sm btn-primary mr-2"
                                                                            data-bs-toggle="modal"
                                                                            data-bs-target="#editAddressModal-<%= item._id %>">
                                                                            Edit
                                                                        </button>
                                                                        <button type="button"
                                                                            class="btn btn-sm btn-danger deleteAddressButton"
                                                                            data-address-id="<%= item._id %>"
                                                                            data-bs-toggle="modal"
                                                                            data-bs-target="#deleteConfirmationModal">
                                                                            Delete
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <% }) %>
                                                            <% }) %>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-lg-6">
                                                <button class="btn btn-primary mt-3" data-bs-toggle="modal"
                                                    data-bs-target="#addAddressModal">Add Address</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="account-detail" role="tabpanel"
                                        aria-labelledby="account-detail-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5>Account Details</h5>
                                            </div>
                                            <div class="card-body">
                                                <form id="changeaccount" method="post">
                                                    <div class="row">
                                                        <div class="form-group col-md-6">
                                                            <label>Name</label>
                                                            <input class="form-control square" name="name" id="name"
                                                                type="text">
                                                            <span id="changenameError" class="error"></span>
                                                        </div>
                                                        <div class="form-group col-md-6">
                                                            <label>Phone</label>
                                                            <input class="form-control square" name="phone" id="phone"
                                                                type="number">
                                                            <span id="changephoneError" class="error"></span>
                                                        </div>
                                                        <div class="form-group col-md-12">
                                                            <label>Email Address</label>
                                                            <input class="form-control square" name="email" id="email"
                                                                type="email">
                                                            <span id="changeemailError" class="error"></span>
                                                        </div>
                                                        <div class="col-md-12">
                                                            <button type="submit" class="btn btn-fill-out submit"
                                                                name="submit" value="Submit"
                                                                onclick="validateAccount()">Save</button>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                        <div class="card mt-3">
                                            <div class="card-header">
                                                <h5>Change Password</h5>
                                            </div>
                                            <div class="card-body">
                                                <form id="changePasswordForm" action="/user/changepassword"
                                                    method="post">
                                                    <div class="row">
                                                        <div class="form-group col-md-12">
                                                            <label>Current Password <span
                                                                    class="required">*</span></label>
                                                            <input class="form-control square" id="currentPassword"
                                                                name="currentPassword" type="password">
                                                            <span id="currentPasswordError" class="error"></span>
                                                        </div>
                                                        <div class="form-group col-md-12">
                                                            <label>New Password <span class="required">*</span></label>
                                                            <input class="form-control square" id="newPassword"
                                                                name="newPassword" type="password">
                                                            <span id="newPasswordError" class="error"></span>
                                                        </div>
                                                        <div class="form-group col-md-12">
                                                            <label>Confirm Password <span
                                                                    class="required">*</span></label>
                                                            <input class="form-control square" id="confirmPassword"
                                                                name="confirmPassword" type="password">
                                                            <span id="confirmPasswordError" class="error"></span>
                                                        </div>
                                                        <div class="col-md-12">
                                                            <button type="submit" onclick="validateChangePassword()"
                                                                class="btn btn-fill-out submit">Save</button>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Add Address Modal -->
    <div class="modal fade" id="addAddressModal" tabindex="-1" aria-labelledby="addAddressModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addAddressModalLabel">Add Address</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addressForm" action="/user/address" method="post">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="inputName" class="form-label">Name</label>
                                <input type="text" class="form-control" name="name" id="inputName">
                                <div id="nameError" class="error-message"></div>
                            </div>
                            <div class="col-md-6">
                                <label for="inputMobile" class="form-label">Mobile Number</label>
                                <input type="number" class="form-control" name="phone" id="inputMobile">
                                <div id="phoneError" class="error-message"></div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="inputAddress" class="form-label">Address</label>
                            <textarea class="form-control" id="inputAddress" rows="3" name="address"></textarea>
                            <div id="addressError" class="error-message"></div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="inputDistrict" class="form-label">District</label>
                                <input type="text" class="form-control" id="inputDistrict" name="district">
                                <div id="districtError" class="error-message"></div>
                            </div>
                            <div class="col-md-6">
                                <label for="inputState" class="form-label">State</label>
                                <input type="text" class="form-control" id="inputState" name="state">
                                <div id="stateError" class="error-message"></div>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="inputCity" class="form-label">City</label>
                                <input type="text" class="form-control" id="inputCity" name="city">
                                <div id="cityError" class="error-message"></div>
                            </div>
                            <div class="col-md-6">
                                <label for="inputPincode" class="form-label">Pincode</label>
                                <input type="number" class="form-control" id="inputPincode" name="pincode">
                                <div id="pincodeError" class="error-message"></div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label>Address Type</label>
                            <div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="addressType" id="addressType"
                                        value="work">
                                    <label class="form-check-label" for="workAddress">Work</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="addressType" id="addressType"
                                        value="home" checked>
                                    <label class="form-check-label" for="homeAddress">Home</label>
                                    <div id="addressTypeError" class="error-message"></div>
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary" onclick="validateAddress()">Submit</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Address Modal -->
    <% addresses.forEach(address=> { %>
        <% address.items.forEach(item=> { %>
            <div class="modal fade" id="editAddressModal-<%= item._id %>" tabindex="-1"
                aria-labelledby="editAddressModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="editAddressModalLabel">Edit Address</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form id="editAddressForm" action="/user/editaddress/<%= item._id %>" method="post">
                                <div id="error-message"></div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="editInputName" class="form-label">Name</label>
                                        <input type="text" class="form-control" id="editInputName" name="name"
                                            value="<%= item.name %>" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="editInputMobile" class="form-label">Mobile Number</label>
                                        <input type="text" class="form-control" id="editInputMobile" name="phone"
                                            value="<%= item.phone %>" required>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="editInputAddress" class="form-label">Address</label>
                                    <textarea class="form-control" id="editInputAddress" rows="3" name="address"
                                        required><%= item.address %></textarea>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="editInputDistrict" class="form-label">District</label>
                                        <input type="text" class="form-control" id="editInputDistrict" name="district"
                                            value="<%= item.district %>" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="editInputState" class="form-label">State</label>
                                        <input type="text" class="form-control" id="editInputState" name="state"
                                            value="<%= item.state %>" required>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="editInputCity" class="form-label">City</label>
                                        <input type="text" class="form-control" id="editInputCity" name="city"
                                            value="<%= item.city %>" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="editInputPincode" class="form-label">Pincode</label>
                                        <input type="text" class="form-control" id="editInputPincode" name="pincode"
                                            value="<%= item.pincode %>" required>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label>Edit Address Type</label>
                                    <div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="addressType"
                                                id="editWorkAddress" value="work" <%=item.addressType==='work'
                                                ? 'checked' : '' %>>
                                            <label class="form-check-label" for="editWorkAddress">Work</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="addressType"
                                                id="editHomeAddress" value="home" <%=item.addressType==='home'
                                                ? 'checked' : '' %>>
                                            <label class="form-check-label" for="editHomeAddress">Home</label>
                                        </div>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">Save Changes</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <% }) %>
                <% }) %>

                    <div class="modal fade" id="deleteConfirmationModal" tabindex="-1"
                        aria-labelledby="deleteConfirmationModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="deleteConfirmationModalLabel">Delete Address</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    Are you sure you want to delete this address?
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                        data-bs-dismiss="modal">Cancel</button>
                                    <button type="button" class="btn btn-danger" id="confirmDelete">Delete</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
                    <script>
                        const deleteButtons = document.querySelectorAll('.deleteAddressButton');
                        const confirmDeleteButton = document.getElementById('confirmDelete');

                        deleteButtons.forEach(button => {
                            button.addEventListener('click', (event) => {
                                const addressId = button.getAttribute('data-address-id');
                                confirmDeleteButton.setAttribute('data-address-id', addressId);
                            });
                        });

                        confirmDeleteButton.addEventListener('click', () => {
                            const addressId = confirmDeleteButton.getAttribute('data-address-id');
                            fetch(`/user/deleteaddress/${addressId}`, {
                                method: 'DELETE'
                            })
                                .then(response => response.json())
                                .then(data => {
                                    const cardToRemove = document.querySelector(`[data-address-id='${addressId}']`).closest('.col-lg-6');
                                    cardToRemove.remove();
                                    // Close the modal
                                    const deleteConfirmationModal = new bootstrap.Modal(document.getElementById('deleteConfirmationModal'));
                                    deleteConfirmationModal.hide();
                                })
                                .catch(error => console.error('Error:', error));
                        });



                        function validateChangePassword() {
                            event.preventDefault();
                            var currentPassword = document.getElementById("currentPassword").value.trim();
                            var newPassword = document.getElementById("newPassword").value.trim();
                            var confirmPassword = document.getElementById("confirmPassword").value.trim();
                            var valid = true;

                            // Reset error messages
                            document.getElementById("currentPasswordError").innerText = "";
                            document.getElementById("newPasswordError").innerText = "";
                            document.getElementById("confirmPasswordError").innerText = "";

                            // Check if fields are empty
                            if (!currentPassword) {
                                document.getElementById("currentPasswordError").innerText = "Current password is required";
                                document.getElementById("currentPasswordError").style.color = "red";
                                valid = false;
                            }

                            if (!newPassword) {
                                document.getElementById("newPasswordError").innerText = "New password is required";
                                document.getElementById("newPasswordError").style.color = "red";
                                valid = false;
                            }

                            if (!confirmPassword) {
                                document.getElementById("confirmPasswordError").innerText = "Confirm password is required";
                                document.getElementById("confirmPasswordError").style.color = "red";
                                valid = false;
                            }

                            if (newPassword !== confirmPassword) {
                                document.getElementById("confirmPasswordError").innerText = "New password and confirm password do not match";
                                document.getElementById("confirmPasswordError").style.color = "red";
                                valid = false;
                            }

                            if (!valid) {
                                return;
                            }

                            fetch('/user/changepassword', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({ currentPassword, newPassword, confirmPassword })
                            })
                                .then(response => {
                                    if (!response.ok) {
                                        return response.json().then(error => {
                                            if (error.error === 'Current password is incorrect') {
                                                document.getElementById("currentPasswordError").innerText = error.error;
                                                document.getElementById("currentPasswordError").style.color = "red";
                                            }
                                        });
                                    }

                                    Swal.fire({
                                        icon: 'success',
                                        title: 'Success',
                                        text: 'Password changed successfully',
                                        timer: 2000
                                    }).then(() => {
                                        document.getElementById("changePasswordForm").reset();
                                    });
                                })
                                .catch(error => {
                                    console.error('Error:', error);
                                });
                        }



                        function validateAddress() {
                            event.preventDefault()
                            var name = document.getElementById("inputName").value.trim();
                            var phone = document.getElementById("inputMobile").value.trim();
                            var address = document.getElementById("inputAddress").value.trim();
                            var district = document.getElementById("inputDistrict").value.trim();
                            var state = document.getElementById("inputState").value.trim();
                            var city = document.getElementById("inputCity").value.trim();
                            var pincode = document.getElementById("inputPincode").value.trim();
                            var addressType = document.querySelector('input[name="addressType"]:checked').value;
                            var valid = true;

                            // Name validation
                            if (!name) {
                                document.getElementById("nameError").innerText =
                                    "Name is required";
                                document.getElementById("nameError").style.color = "red";
                                valid = false;
                            } else {
                                document.getElementById("nameError").innerText = "";
                            }


                            if (!phone) {
                                document.getElementById("phoneError").innerText = "Phone number is required";
                                document.getElementById("phoneError").style.color = "red"; // Set color to red
                                valid = false;
                            } else if (phone.length !== 10) {
                                document.getElementById("phoneError").innerText = "Please enter a 10-digit number";
                                document.getElementById("phoneError").style.color = "red"; // Set color to red
                                valid = false;
                            } else {
                                document.getElementById("phoneError").innerText = "";
                            }

                            if (!address) {
                                document.getElementById("addressError").innerText =
                                    "Address is required";
                                document.getElementById("addressError").style.color = "red";
                                valid = false;
                            } else {
                                document.getElementById("addressError").innerText = "";
                            }

                            if (!district) {
                                document.getElementById("districtError").innerText =
                                    "District is required";
                                document.getElementById("districtError").style.color = "red";
                                valid = false;
                            } else {
                                document.getElementById("districtError").innerText = "";
                            }

                            if (!state) {
                                document.getElementById("stateError").innerText =
                                    "State is required";
                                document.getElementById("stateError").style.color = "red";
                                valid = false;
                            } else {
                                document.getElementById("stateError").innerText = "";
                            }

                            if (!city) {
                                document.getElementById("cityError").innerText =
                                    "City is required";
                                document.getElementById("cityError").style.color = "red";
                                valid = false;
                            } else {
                                document.getElementById("cityError").innerText = "";
                            }

                            if (!pincode || pincode.length !== 6) {
                                document.getElementById("pincodeError").innerText =
                                    "Pincode must be 6-digits";
                                document.getElementById("pincodeError").style.color = "red";
                                valid = false;
                            } else {
                                document.getElementById("pincodeError").innerText = "";
                            }

                            if (!addressType) {
                                document.getElementById("addressTypeError").innerText =
                                    "AddressType is required";
                                document.getElementById("addressTypeError").style.color = "red";
                                valid = false;
                            } else {
                                document.getElementById("addressTypeError").innerText = "";
                            }

                            if (valid) {
                                document.getElementById("addressForm").submit();
                            }
                        }



                        function validateAccount() {
                            event.preventDefault();
                            var changename = document.getElementById("name").value.trim();
                            var changephone = document.getElementById("phone").value.trim();
                            var changeemail = document.getElementById("email").value.trim();
                            var valid = true;

                            if (!changename) {
                                document.getElementById("changenameError").innerText =
                                    "Name is required";
                                document.getElementById("changenameError").style.color = "red";
                                valid = false;
                            } else {
                                document.getElementById("changenameError").innerText = "";
                            }

                            if (!changephone) {
                                document.getElementById("changephoneError").innerText =
                                    "Phone is required";
                                document.getElementById("changephoneError").style.color = "red";
                                valid = false;
                            } else {
                                document.getElementById("changephoneError").innerText = "";
                            }

                            if (!changeemail) {
                                document.getElementById("changeemailError").innerText =
                                    "Email is required";
                                document.getElementById("changeemailError").style.color = "red";
                                valid = false;
                            } else {
                                document.getElementById("changeemailError").innerText = "";
                            }


                            if (!valid) {
                                return
                            }


                            fetch('/user/accountdetails', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({ changename, changeemail, changephone })
                            }).then(response => {
                                if (response.ok) {
                                    return response.json();
                                }
                                throw new Error('Network response was not ok.');
                            }).then(data => {
                                Swal.fire({
                                    title: 'Success!',
                                    text: data.message,
                                    icon: 'success',
                                    confirmButtonText: 'OK'
                                });
                                document.getElementById('changeaccount').reset();
                            }).catch(error => {
                                console.error('Error:', error);
                                Swal.fire({
                                    title: 'Error!',
                                    text: 'Something went wrong. Please try again later.',
                                    icon: 'error',
                                    confirmButtonText: 'OK'
                                });
                            });
                        }
                    </script>
                    <script>
                        function copyToClipboard() {
                            var referralCode = document.getElementById("referralCode").innerText;

                            var tempInput = document.createElement("input");
                            tempInput.value = referralCode;
                            document.body.appendChild(tempInput);

                            tempInput.select();
                            tempInput.setSelectionRange(0, 99999); /* For mobile devices */

                            document.execCommand("copy");
                            document.body.removeChild(tempInput);

                            Swal.fire({
                                icon: 'success',
                                title: 'Copied!',
                                text: 'Referral code copied to clipboard',
                                showConfirmButton: false,
                                timer: 1500
                            });
                        }
                    </script>




                    <%- include("../layouts/userFooter") %>