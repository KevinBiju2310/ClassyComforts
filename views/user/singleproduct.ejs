<%- include("../layouts/userHeader") %>
    <main class="main">
        <div class="page-header breadcrumb-wrap">
            <div class="container">
                <div class="breadcrumb">
                    <a href="index.html" rel="nofollow">Home</a>
                    <span></span> Fashion
                    <span></span> Abstract Print Patchwork Dress
                </div>
            </div>
        </div>
        <section class="mt-50 mb-50">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="product-detail accordion-detail">
                            <div class="row mb-50">
                                <div class="col-md-6 col-sm-12 col-xs-12">
                                    <div class="detail-gallery">
                                        <span class="zoom-icon"><i class="fi-rs-search"></i></span>
                                        <!-- MAIN SLIDES -->
                                        <div class="product-image-slider">
                                            <% if (product && product.productImages) { %>
                                                <% product.productImages.forEach(function(image) { %>
                                                    <figure class="border-radius-10">
                                                        <img id="mainImage" src="/uploads/<%=image%>"
                                                            alt="product image">
                                                    </figure>
                                                    <% }) %>
                                                        <% } %>
                                        </div>
                                        <!-- THUMBNAILS -->
                                        <div class="slider-nav-thumbnails pl-15 pr-15">
                                            <% if (product && product.productImages && product.productImages.length> 0)
                                                { %>
                                                <% product.productImages.forEach(function(image) { %>
                                                    <div>
                                                        <img src="/uploads/<%= image %>" alt="product image">
                                                    </div>
                                                    <% }); %>
                                                        <% } %>
                                        </div>
                                    </div>
                                    <!-- End Gallery -->
                                </div>


                                <script>
                                    function changeMainImage(imageUrl) {
                                        const mainImage = document.getElementById('thumbnailContainer');
                                        mainImage.src = imageUrl;
                                    }

                                </script>

                                <div class="col-md-6 col-sm-12 col-xs-12">
                                    <div class="detail-info">
                                        <h2 class="title-detail">
                                            <%= product.productname %>
                                        </h2>
                                        <div class="product-detail-rating">
                                            <div class="pro-details-brand">
                                                <span> Category: <a href="shop-grid-right.html">
                                                        <%= product.category %>
                                                    </a></span>
                                            </div>
                                        </div>
                                        <div class="clearfix product-price-cover">
                                            <div class="product-price primary-color float-left">
                                                <% if (product.mainprice !==0 && product.mainprice < product.price) { %>
                                                    <ins><span class="text-brand">$<%= product.mainprice.toFixed(2) %>
                                                        </span></ins>
                                                    <ins><span class="old-price font-md ml-15">$<%=
                                                                product.price.toFixed(2) %></span></ins>
                                                    <span class="discount ml-5"
                                                        style="color: green; font-size: 20px; font-weight: bolder;">(<%=
                                                            product.discount.toFixed(0) %>% Offer)</span>
                                                    <% } else { %>
                                                        <ins><span class="text-brand">$<%= product.price.toFixed(2) %>
                                                            </span></ins>
                                                        <% } %>
                                            </div>
                                        </div>
                                        <div class="bt-1 border-color-1 mt-15 mb-15"></div>
                                        <div class="short-desc mb-30">
                                            <p>
                                                <%= product.description %>
                                            </p>
                                        </div>
                                        <div class="product_sort_info font-xs mb-30">
                                            <ul>
                                                <li class="mb-10"><i class="fi-rs-crown mr-5"></i> 1 Year AL Jazeera
                                                    Brand Warranty</li>
                                                <li class="mb-10"><i class="fi-rs-refresh mr-5"></i> 30 Day Return
                                                    Policy</li>
                                                <li><i class="fi-rs-credit-card mr-5"></i> Cash on Delivery available
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="bt-1 border-color-1 mt-30 mb-30"></div>
                                        <div class="detail-extralink">
                                            <div class="detail-qty border radius">
                                                <a href="#" class="qty-down"><i class="fi-rs-angle-small-down"></i></a>
                                                <span class="qty-val">1</span>
                                                <a href="#" class="qty-up"><i class="fi-rs-angle-small-up"></i></a>
                                            </div>
                                            <div class="product-extra-link2">
                                                <button type="submit" class="button button-add-to-cart">Buy Now</button>
                                                <a aria-label="Add To Wishlist"
                                                    class="action-btn hover-up add-to-wishlist" href="#"
                                                    data-product-id="<%= product._id %>">
                                                    <i class="fi-rs-heart"></i>
                                                </a>
                                                <a aria-label="Add To Cart" class="action-btn hover-up add-to-cart"
                                                    href="#" data-product-id="<%= product._id %>">
                                                    <i class="fi-rs-shopping-bag-add"></i></a>
                                            </div>
                                        </div>
                                        <ul class="product-meta font-xs color-grey mt-50">
                                            <li>Availability:<span class="in-stock text-success ml-5">
                                                    <%= product.quantity %> Items In
                                                        Stock
                                                </span></li>
                                        </ul>
                                    </div>
                                    <!-- Detail Info -->
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-10 m-auto entry-main-content">
                                    <h3 class="section-title style-1 mb-30">Additional info</h3>
                                    <table class="font-md mb-30">
                                        <tbody>
                                            <tr class="stand-up">
                                                <th>Product Dimension</th>
                                                <td>
                                                    <p>
                                                        <%= product.length %>″L x <%= product.width %>″W x <%=
                                                                    product.height %>″H
                                                    </p>
                                                </td>
                                            </tr>
                                            <tr class="folded-wo-wheels">
                                                <th>Material</th>
                                                <td>
                                                    <p>
                                                        <%= product.material %>
                                                    </p>
                                                </td>
                                            </tr>
                                            <tr class="door-pass-through">
                                                <th>Shape</th>
                                                <td>
                                                    <p>
                                                        <%= product.shape %>
                                                    </p>
                                                </td>
                                            </tr>
                                            <tr class="frame">
                                                <th>Weight</th>
                                                <td>
                                                    <p>
                                                        <%= product.weight %>
                                                    </p>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="row mt-60">
                                <div class="col-12">
                                    <h3 class="section-title style-1 mb-30">Related products</h3>
                                </div>
                                <div class="col-12">
                                    <div class="row related-products">
                                        <% if(relatedProducts && relatedProducts.length>0) { %>
                                            <% relatedProducts.forEach(relatedProduct=> { %>
                                                <div class="col-lg-3 col-md-4 col-12 col-sm-6">
                                                    <div class="product-cart-wrap small hover-up">
                                                        <div class="product-img-action-wrap">
                                                            <div class="product-img product-img-zoom">
                                                                <a href="/user/singleproduct/<%= relatedProduct.id %>"
                                                                    tabindex="0">
                                                                    <img class="default-img"
                                                                        src="/uploads/<%= relatedProduct.productImages[0] %>"
                                                                        alt="">
                                                                    <img class="hover-img"
                                                                        src="/uploads/<%= relatedProduct.productImages[0] %>"
                                                                        alt="">
                                                                </a>
                                                            </div>
                                                            <div class="product-action-1">
                                                                <a aria-label="Quick view"
                                                                    class="action-btn small hover-up"
                                                                    data-bs-toggle="modal"
                                                                    data-bs-target="#quickViewModal"><i
                                                                        class="fi-rs-search"></i></a>
                                                                <a aria-label="Add To Wishlist"
                                                                    class="action-btn small hover-up"
                                                                    href="shop-wishlist.html" tabindex="0"><i
                                                                        class="fi-rs-heart"></i></a>
                                                                <a aria-label="Compare"
                                                                    class="action-btn small hover-up"
                                                                    href="shop-compare.html" tabindex="0"><i
                                                                        class="fi-rs-shuffle"></i></a>
                                                            </div>
                                                            <div
                                                                class="product-badges product-badges-position product-badges-mrg">
                                                                <span class="hot">Hot</span>
                                                            </div>
                                                        </div>
                                                        <div class="product-content-wrap">
                                                            <h2><a href="shop-product-right.html" tabindex="0">
                                                                    <%= relatedProduct.productname %>
                                                                </a></h2>
                                                            <div class="rating-result" title="90%">
                                                                <span>
                                                                </span>
                                                            </div>
                                                            <div class="product-price">
                                                                <% if (relatedProduct.mainprice !==0 &&
                                                                    relatedProduct.mainprice < relatedProduct.price) {
                                                                    %>
                                                                    <span>$<%= relatedProduct.mainprice.toFixed(2) %>
                                                                    </span>
                                                                    <span class="old-price">$<%=
                                                                            relatedProduct.price.toFixed(2) %></span>
                                                                    <% } else { %>
                                                                        <span>$<%= relatedProduct.price.toFixed(2) %>
                                                                        </span>
                                                                        <span class="old-price">$<%=
                                                                                relatedProduct.mainprice.toFixed(2) %>
                                                                        </span>
                                                                        <% } %>
                                                            </div>

                                                        </div>
                                                    </div>
                                                </div>
                                                <% }); %>
                                                    <% } else { %>
                                                        <p>No related products found.</p>
                                                        <% } %>
                                    </div>
                                </div>
                            </div>
                            <div class="banner-img banner-big wow fadeIn f-none animated mt-50">
                                <img class="border-radius-10" src="/assets/imgs/banner/banner-4.png" alt="">
                                <div class="banner-text">
                                    <h4 class="mb-15 mt-40">Repair Services</h4>
                                    <h2 class="fw-600 mb-20">We're an Apple <br>Authorised Service Provider</h2>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <%- include("../layouts/userFooter") %>



        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const addToWishlistButtons = document.querySelectorAll(".add-to-wishlist");
                const addToCartButtons = document.querySelectorAll(".add-to-cart");

                addToWishlistButtons.forEach(button => {
                    button.addEventListener("click", function (e) {
                        e.preventDefault();
                        const productId = button.getAttribute("data-product-id");

                        fetch("/user/addtowishlist", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify({ productId: productId })
                        })
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error("Network response was not ok");
                                }
                                return response.json();
                            })
                            .then(data => {
                                if (data.alreadyInWishlist) {
                                    Swal.fire({
                                        icon: 'info',
                                        title: 'Already in Wishlist!',
                                        text: 'This product is already in your wishlist.'
                                    });
                                } else {
                                    Swal.fire({
                                        icon: 'success',
                                        title: 'Added to Wishlist!',
                                        text: 'This product has been added to your wishlist.'
                                    })
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Oops...',
                                    text: 'Something went wrong! Please try again.'
                                });
                            });
                    });
                });

                addToCartButtons.forEach(button => {
                    button.addEventListener("click", function (e) {
                        e.preventDefault();
                        const productId = button.getAttribute("data-product-id");

                        fetch("/user/addtocart", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify({ productId: productId })
                        })
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error("Network response was not ok");
                                }
                                return response.json();
                            })
                            .then(data => {
                                if (data.alreadyInCart) {
                                    Swal.fire({
                                        icon: 'info',
                                        title: 'Already in Cart!',
                                        text: 'This product is already in your Cart.'
                                    });
                                } else {
                                    Swal.fire({
                                        icon: 'success',
                                        title: 'Added to Cart!',
                                        text: 'This product has been added to your Cart.'
                                    })
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Oops...',
                                    text: 'Something went wrong! Please try again.'
                                });
                            });
                    });
                });
            });
        </script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>